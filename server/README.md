# О сервере
## Основные библиотеки
Сервер программы построен на библиотеке [FastAPI](https://fastapi.tiangolo.com/)
В качестве базы данных используется **sqlite3**.

## Что умеет сервер
- Сервер имеет [REST API](#rest-api) для создания, сохранения, чтения и удаления записей в базе данных.
- На индексной странице есть возможность просматривать сохраненные в базе данных записи без регистрации.

---

# Установка сервера
## Инициализация базы данных (Делать только при первом запуске!)
Перед запуском сервера, нужно проинициализировать базу данных.
Для этого:
1. Перейдите в корневой каталог сервера (там где лежит файл **main.py**)
2. Из терминала/консоли запустите команду: `python3 SqliteClasses.py sql_scripts/DatabaseReinstall.sql`
3. Ответ этой команды должен быть `Successfully executed`. Это показывает, что скрипт инициализации базы данных был успешно выполнен

## Запуск самого сервера
**Примечание:** *в данном тексте показывается только как запустить сервер на локальной машине. Для запуска сервера в открытый интернет ищите другие уроки*

### Установка ASGI сервера
Теперь надо запустить сам сервер. Для этого надо скачать какой-либо **ASGI веб-сервер**.
В *requirements.txt* сервера указан один из таких - [uvicorn](https://www.uvicorn.org/).
Если вы устанавливали библиотеки не с помощью этого файла, то этот веб-сервер можно установить с помощью команды `pip install "uvicorn[standard]"`

### Пример запуска сервера с помощью [uvicorn](https://www.uvicorn.org/)
Для запуска сервера надо перейти в корневой католог сервера (где лежит файл **main.py**), после чего прописать в консоле такую команду:
`uvicorn main:app`

Вывод сервера должен быть похож на что-то типо:
```
rodion@computer:~/projects/python/fastnote/server$ uvicorn main:app
INFO:     Started server process [55128]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

**Готово! Сервер работает, и к нему можно подключиться!**

---

# REST API
## /api/get_token
Что делает: **Возвращает рандомный токен для работы с API**

Методы: **GET**

### GET
Параметры: **нет**
Возвращает: **json объект с токеном**:
```json
{
    "token": "NEW_TOKEN"
}
```

## /api/<YOUR_TOKEN>/note
Что делает: **Возвращает список id записей пользователя / Создает новую запись**

Методы: **GET POST**

### GET
> Возвращает список id записей пользователя
Параметры адресной строки:
1. **<YOUR_TOKEN> - токен пользователя**
Параметры тела запроса:
**нет**

Возвращает: **Список id записей пользователя**:
```json
{
    "ids": [
        "1_note_id",
        "2_note_id",
        "3_note_id",
        ...
    ]
}
```

### POST
> Создает новую запись
Параметры адресной строки:
1. **<YOUR_TOKEN> - токен пользователя**
Параметры тела запроса:
**JSON объект типа:**
```json
{
    "text": "TEXT_OF_NEW_NOTE",
    "is_private": true OR false
}
```

Возвращает: **id новой записи**:
```json
{
    "id": "new_note_id"
}
```

## /api/<YOUR_TOKEN>/note/<NOTE_ID>
Что делает: **Возвращает детали записи / Изменяет существующую запись / Удаляет запись**

Методы: **GET PATCH DELETE**

### GET
> Возвращает детали записи
Параметры адресной строки:
1. **<YOUR_TOKEN> - токен пользователя**
2. **<NOTE_ID> - id записи**
Параметры тела запроса:
**нет**

Возвращает: **Возвращает детали записи**:
```json
{
    "id": "NOTE_ID",
    "text": "NOTE_TEXT",
    "is_private": false OR true,
}
```

### PATCH
> Изменяет существующую запись
Параметры адресной строки:
1. **<YOUR_TOKEN> - токен пользователя**
2. **<NOTE_ID> - id записи**
Параметры тела запроса:
**JSON объект типа:**
```json
{
    "text": "NEW_TEXT_OF_NOTE",
    "is_private": true OR false
}
```

Возвращает: **Текст об успешном выполнении**:
```json
{
    "ok" : true
}
```

### DELETE
> Удаляет запись
Параметры адресной строки:
1. **<YOUR_TOKEN> - токен пользователя**
2. **<NOTE_ID> - id записи**
Параметры тела запроса:
**нет**

Возвращает: **Ничего**
